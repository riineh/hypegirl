<!doctype html>
<html lang="en">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-177834192-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-177834192-1');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700;800&display=swap" rel="stylesheet">
    <title>HypeGirl</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">

        <div class="rounded" id="mainBox">
            <h1>Hype<span>Girl</span></h1>
            <h2>A short but sweet newsletter every Sunday!</h2>
            <input id="input" placeholder="Email" name="email"/>
            <button id="submit">Submit!</button>
            <p class="message" id="successMessage">You are one of us now! Thanks for submitting :)</p>
            <p class="message" id="errorMessage">Email entered is not valid...try again!</p>
        </div>

        <div class="rounded" id="whyBox">
            <h1>Why?</h1>
            <h2>Sometimes life gets hard ... or boring ... or both. And that’s why hearing about new interesting articles, skills to master and just rants about life is so important for keeping on track and living your best life.
                <br>The HypeGirl newsletter is like talking to that one wise nerdy friend - you never know what you’re going to get but it’s never boring.
            </h2>

        </div>

    </div>
</body>
</html>

<script>
    let submitButton = document.getElementById('submit');
    let inputField = document.getElementById('input');
    let successMessage = document.getElementById('successMessage');
    let errorMessage = document.getElementById('errorMessage');


    // var $form = $('form#test-form');
    var url = 'https://script.google.com/macros/s/AKfycbxJ-ZR4oLVY9VQSKevX6lIHvXJyPYmiaFUIlRJiIuE0l3ZJMh0R/exec';

    submitButton.onclick = (event) => {
        let email = inputField.value;

        if (!email) {
          hideErrorMessage();
          hideSuccessMessage();
        } else if (!validateEmail(email)) {
          handleError(email);
        } else {
          sendEmailToSheets(email);
          showSuccessMessageAndClearInput();
        }
    }

    function validateEmail(email) {
      const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
      return re.test(String(email).toLowerCase());
    }

    function sendEmailToSheets(email) {
      $.ajax({
        url: url,
        method: "GET",
        dataType: "json",
        data: {'Email': email}
      }).success();

      console.log("Email sent! Thanks!")
    }

    function handleError(input) {
      hideSuccessMessage();
      showErrorMessage();
    }

    function showSuccessMessageAndClearInput() {
      hideErrorMessage();
      showSuccessMessage();
      clearInput();
    }

    function showSuccessMessage() {
      successMessage.style.display = 'inline-block';
    }

    function hideSuccessMessage() {
      successMessage.style.display = 'none';
    }

    function clearInput() {
      inputField.value = '';
    }

    function showErrorMessage() {
      errorMessage.style.display = 'inline-block';
    }

    function hideErrorMessage() {
      errorMessage.style.display = 'none';
    }


</script>